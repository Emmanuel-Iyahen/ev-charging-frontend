<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVCharge - Admin CPMS</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-bolt logo"></i>
                <h2>EVCharge CPMS</h2>
            </div>
            <ul class="sidebar-nav">
                <li class="nav-item active">
                    <a href="#dashboard" class="nav-link">
                        <i class="fas fa-chart-line"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#stations" class="nav-link">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Stations</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#users" class="nav-link">
                        <i class="fas fa-users"></i>
                        <span>Users</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#sessions" class="nav-link">
                        <i class="fas fa-battery-full"></i>
                        <span>Sessions</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#settings" class="nav-link">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Topbar -->
            <header class="topbar">
                <div class="topbar-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="page-title">Dashboard</h1>
                </div>
                <div class="topbar-right">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <div class="user-menu">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="user-name" id="user-name">Admin User</span>
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-stations">0</h3>
                                <p>Total Stations</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-charge-points">0</h3>
                                <p>Charge Points</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="total-users">0</h3>
                                <p>Total Users</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-battery-full"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="active-sessions">0</h3>
                                <p>Active Sessions</p>
                            </div>
                        </div>
                    </div>

                    <div class="charts-container">
                        <div class="chart-card">
                            <h3>Station Status</h3>
                            <div id="station-chart" class="chart-placeholder">
                                <canvas id="stationChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h3>Charge Points Distribution</h3>
                            <div id="distribution-chart" class="chart-placeholder">
                                <canvas id="distributionChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="recent-activity">
                        <h3>Recent Activity</h3>
                        <div class="activity-list" id="activity-list">
                            <!-- Activity items will be loaded here -->
                        </div>
                    </div>
                </div>

                Stations Page
                <div id="stations-page" class="page">
                    <div class="page-header">
                        <h2>Charging Stations</h2>
                        <button class="btn btn-primary" onclick="showAddStationModal()">
                            <i class="fas fa-plus"></i> Add Station
                        </button>
                    </div>
                    
                    <div class="filters">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="station-search" placeholder="Search stations...">
                        </div>
                        <select id="station-filter">
                            <option value="all">All Stations</option>
                            <option value="available">Available Only</option>
                            <option value="unavailable">Unavailable</option>
                        </select>
                    </div>

                    <div class="stations-grid" id="stations-grid">
                        <!-- Stations will be loaded here -->
                    </div>
                </div>

                <!-- Users Page -->
                <div id="users-page" class="page">
                    <div class="page-header">
                        <h2>User Management</h2>
                    </div>
                    
                    <div class="filters">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="user-search" placeholder="Search users...">
                        </div>
                        <select id="user-filter">
                            <option value="all">All Users</option>
                            <option value="admin">Administrators</option>
                            <option value="user">Regular Users</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Joined</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Users will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Sessions Page -->
                <div id="sessions-page" class="page">
                    <div class="page-header">
                        <h2>Charging Sessions</h2>
                    </div>
                    
                    <div class="filters">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="session-search" placeholder="Search sessions...">
                        </div>
                        <select id="session-filter">
                            <option value="all">All Sessions</option>
                            <option value="active">Active Only</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>

                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Session ID</th>
                                    <th>User</th>
                                    <th>Charge Point</th>
                                    <th>Duration</th>
                                    <th>Energy</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sessions-table-body">
                                <!-- Sessions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settings-page" class="page">
                    <div class="page-header">
                        <h2>System Settings</h2>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="settings-card">
                            <h3>General Settings</h3>
                            <form id="general-settings">
                                <div class="form-group">
                                    <label>System Name</label>
                                    <input type="text" value="EVCharge CPMS">
                                </div>
                                <div class="form-group">
                                    <label>Default Charging Rate (kW)</label>
                                    <input type="number" value="7.4" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label>Session Timeout (minutes)</label>
                                    <input type="number" value="30">
                                </div>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </form>
                        </div>
                        
                        <div class="settings-card">
                            <h3>System Information</h3>
                            <div class="info-item">
                                <span>Version</span>
                                <span>1.0.0</span>
                            </div>
                            <div class="info-item">
                                <span>Last Updated</span>
                                <span id="last-updated">-</span>
                            </div>
                            <div class="info-item">
                                <span>Database Status</span>
                                <span class="status-badge online">Connected</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Station Modal -->
    <div id="add-station-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Station</h3>
                <button class="close-modal" onclick="closeAddStationModal()">&times;</button>
            </div>
            <form id="add-station-form">
                <div class="form-group">
                    <label>Station Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label>Location</label>
                    <input type="text" name="location" required>
                </div>
                <div class="form-group">
                    <label>Total Connectors</label>
                    <input type="number" name="total_connectors" value="1" min="1" required>
                </div>
                <div class="form-group">
                    <label>Power Output (kW)</label>
                    <input type="number" name="power_output_kw" value="7.4" step="0.1" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddStationModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Station</button>
                </div>
            </form>
        </div>
    </div>



    <script>
// Debug script loading
console.log('=== SCRIPT LOADING CHECK ===');
console.log('auth.js loaded:', typeof checkAuth !== 'undefined');
console.log('api.js loaded:', typeof getDashboardData !== 'undefined');
console.log('dashboard.js loaded:', typeof initDashboard !== 'undefined');

// Test if functions are available
if (typeof getDashboardData === 'undefined') {
    console.error('❌ getDashboardData is NOT defined - check api.js loading');
} else {
    console.log('✅ getDashboardData is defined');
}

if (typeof initDashboard === 'undefined') {
    console.error('❌ initDashboard is NOT defined - check dashboard.js loading');
} else {
    console.log('✅ initDashboard is defined');
}
</script>

    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/stations.js"></script>
    <script src="js/users.js"></script>
    <script src="js/sessions.js"></script>
    <script src="js/main.js"></script> -->


    <!-- Only these two script tags -->
<script src="js/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>

























// ===== EV Charging Admin CPMS - Combined App =====
console.log('🚀 EV Charging Admin CPMS loaded');

const API_BASE_URL = 'http://localhost:8000';

// ===== AUTHENTICATION FUNCTIONS =====
function checkAuth() {
    const token = localStorage.getItem('admin_token');
    if (!token) {
        window.location.href = 'login.html';
        return false;
    }
    return true;
}

async function getCurrentUser() {
    try {
        const token = localStorage.getItem('admin_token');
        const response = await fetch(`${API_BASE_URL}/auth/me`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error('Failed to fetch user data');
        }

        return await response.json();
    } catch (error) {
        console.error('Error fetching user:', error);
        logout();
        return null;
    }
}

function logout() {
    localStorage.removeItem('admin_token');
    window.location.href = 'login.html';
}

function updateUserInfo(user) {
    const userNameElement = document.getElementById('user-name');
    if (userNameElement && user) {
        userNameElement.textContent = user.full_name;
    }
}

// ===== API FUNCTIONS =====
async function getDashboardData() {
    console.log('📊 Fetching dashboard data...');
    try {
        const token = localStorage.getItem('admin_token');
        const response = await fetch(`${API_BASE_URL}/admin/dashboard`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`API call failed: ${response.status}`);
        }

        const data = await response.json();
        console.log('✅ Dashboard data received:', data);
        return data;
    } catch (error) {
        console.error('❌ Error fetching dashboard data:', error);
        // Return mock data for development
        return {
            statistics: {
                total_stations: 3,
                total_charge_points: 8,
                total_users: 15,
                active_sessions: 2
            },
            station_status: [
                { station_id: 1, station_name: 'Downtown Charging Hub', available: 3, charging: 1, unavailable: 0, total: 4 },
                { station_id: 2, station_name: 'Shopping Mall Chargers', available: 2, charging: 0, unavailable: 0, total: 2 },
                { station_id: 3, station_name: 'Airport Terminal', available: 1, charging: 1, unavailable: 1, total: 3 }
            ]
        };
    }
}

async function getStations() {
    try {
        const token = localStorage.getItem('admin_token');
        const response = await fetch(`${API_BASE_URL}/stations/`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`API call failed: ${response.status}`);
        }

        return await response.json();
    } catch (error) {
        console.error('Error fetching stations:', error);
        // Mock stations data
        return [
            {
                id: 1,
                name: 'Downtown Charging Hub',
                location: '123 Main Street, Downtown',
                total_connectors: 4,
                available_connectors: 3,
                power_output_kw: 22.0,
                created_at: '2024-01-15T10:00:00Z'
            },
            {
                id: 2,
                name: 'Shopping Mall Chargers',
                location: '456 Oak Avenue, Shopping District',
                total_connectors: 2,
                available_connectors: 2,
                power_output_kw: 7.4,
                created_at: '2024-01-20T14:30:00Z'
            }
        ];
    }
}

async function getUsers() {
    try {
        const token = localStorage.getItem('admin_token');
        const response = await fetch(`${API_BASE_URL}/admin/users`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`API call failed: ${response.status}`);
        }

        return await response.json();
    } catch (error) {
        console.error('Error fetching users:', error);
        // Mock users data
        return [
            {
                id: 1,
                email: 'admin@evcharging.com',
                full_name: 'System Administrator',
                is_admin: true,
                is_active: true,
                created_at: '2024-01-01T00:00:00Z'
            },
            {
                id: 2,
                email: 'john.doe@example.com',
                full_name: 'John Doe',
                is_admin: false,
                is_active: true,
                created_at: '2024-01-10T14:20:00Z'
            }
        ];
    }
}

async function getSessions() {
    try {
        const token = localStorage.getItem('admin_token');
        const response = await fetch(`${API_BASE_URL}/admin/charging-sessions`, {
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`API call failed: ${response.status}`);
        }

        return await response.json();
    } catch (error) {
        console.error('Error fetching sessions:', error);
        // Mock sessions data
        return [
            {
                id: 1,
                user_id: 2,
                charge_point_id: 1,
                station_id: 1,
                start_time: '2024-01-20T10:30:00Z',
                end_time: null,
                energy_consumed_kwh: 5.2,
                current_power_kw: 7.4,
                is_active: true
            }
        ];
    }
}

// ===== DASHBOARD FUNCTIONS =====
let stationChart, distributionChart;

async function initDashboard() {
    console.log('🚀 Initializing dashboard...');
    
    if (!checkAuth()) {
        console.log('User not authenticated');
        return;
    }

    try {
        const user = await getCurrentUser();
        updateUserInfo(user);

        const dashboardData = await getDashboardData();
        updateDashboardStats(dashboardData);
        updateCharts(dashboardData);
        updateRecentActivity(dashboardData);
        
        console.log('✅ Dashboard initialized successfully');
    } catch (error) {
        console.error('❌ Error initializing dashboard:', error);
        showError('Failed to load dashboard data: ' + error.message);
    }
}

function updateDashboardStats(data) {
    console.log('Updating dashboard stats...');
    const stats = data.statistics;

    // Safely update each element
    const elements = {
        'total-stations': stats.total_stations || 0,
        'total-charge-points': stats.total_charge_points || 0,
        'total-users': stats.total_users || 0,
        'active-sessions': stats.active_sessions || 0
    };

    for (const [id, value] of Object.entries(elements)) {
        const element = document.getElementById(id);
        if (element) {
            element.textContent = value;
        } else {
            console.warn(`Element #${id} not found`);
        }
    }
}

function updateCharts(data) {
    if (!data.station_status) {
        console.warn('No station status data for charts');
        return;
    }
    updateStationChart(data.station_status);
    updateDistributionChart(data.station_status);
}

function updateStationChart(stationStatus) {
    const canvas = document.getElementById('stationChart');
    if (!canvas) {
        console.warn('Station chart canvas not found');
        return;
    }

    const ctx = canvas.getContext('2d');
    
    // Destroy existing chart
    if (stationChart) {
        stationChart.destroy();
    }

    const labels = stationStatus.map(station => station.station_name);
    const availableData = stationStatus.map(station => station.available);
    const chargingData = stationStatus.map(station => station.charging);
    const unavailableData = stationStatus.map(station => station.unavailable);

    stationChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'Available',
                    data: availableData,
                    backgroundColor: '#10B981'
                },
                {
                    label: 'Charging',
                    data: chargingData,
                    backgroundColor: '#F59E0B'
                },
                {
                    label: 'Unavailable',
                    data: unavailableData,
                    backgroundColor: '#EF4444'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        stepSize: 1
                    }
                }
            }
        }
    });
}

function updateDistributionChart(stationStatus) {
    const canvas = document.getElementById('distributionChart');
    if (!canvas) {
        console.warn('Distribution chart canvas not found');
        return;
    }

    const ctx = canvas.getContext('2d');
    
    // Destroy existing chart
    if (distributionChart) {
        distributionChart.destroy();
    }

    const totalAvailable = stationStatus.reduce((sum, station) => sum + station.available, 0);
    const totalCharging = stationStatus.reduce((sum, station) => sum + station.charging, 0);
    const totalUnavailable = stationStatus.reduce((sum, station) => sum + station.unavailable, 0);
    const totalFaulted = stationStatus.reduce((sum, station) => 
        sum + (station.total - station.available - station.charging - station.unavailable), 0);

    distributionChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Available', 'Charging', 'Unavailable', 'Faulted'],
            datasets: [{
                data: [totalAvailable, totalCharging, totalUnavailable, totalFaulted],
                backgroundColor: [
                    '#10B981',
                    '#F59E0B',
                    '#EF4444',
                    '#6B7280'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                }
            }
        }
    });
}

function updateRecentActivity(data) {
    const activityList = document.getElementById('activity-list');
    if (!activityList) {
        console.warn('Activity list not found');
        return;
    }
    
    const activities = [
        { type: 'charging_start', user: 'John Doe', station: 'Downtown Hub', time: '2 minutes ago' },
        { type: 'charging_stop', user: 'Jane Smith', station: 'Shopping Mall', time: '5 minutes ago' },
        { type: 'station_added', station: 'Airport Terminal', time: '1 hour ago' }
    ];

    activityList.innerHTML = activities.map(activity => `
        <div class="activity-item">
            <div class="activity-icon">
                <i class="fas fa-${getActivityIcon(activity.type)}"></i>
            </div>
            <div class="activity-details">
                <p>${getActivityText(activity)}</p>
                <small style="color: #64748b;">${activity.time}</small>
            </div>
        </div>
    `).join('');
}

function getActivityIcon(type) {
    const icons = {
        'charging_start': 'bolt',
        'charging_stop': 'battery-full',
        'station_added': 'map-marker-alt'
    };
    return icons[type] || 'info-circle';
}

function getActivityText(activity) {
    switch (activity.type) {
        case 'charging_start':
            return `${activity.user} started charging at ${activity.station}`;
        case 'charging_stop':
            return `${activity.user} stopped charging at ${activity.station}`;
        case 'station_added':
            return `New station added: ${activity.station}`;
        default:
            return 'Activity occurred';
    }
}

// ===== STATIONS PAGE FUNCTIONS =====
async function initStations() {
    console.log('🚀 Initializing stations page...');
    
    if (!checkAuth()) return;

    try {
        const stations = await getStations();
        displayStations(stations);
        setupStationFilters();
    } catch (error) {
        console.error('Error loading stations:', error);
        showError('Failed to load stations');
    }
}

function displayStations(stations) {
    const grid = document.getElementById('stations-grid');
    if (!grid) return;

    grid.innerHTML = stations.map(station => `
        <div class="station-card">
            <div class="station-header">
                <div>
                    <h3 class="station-name">${station.name}</h3>
                    <p class="station-location">${station.location}</p>
                </div>
                <span class="status-badge ${station.available_connectors > 0 ? 'available' : 'unavailable'}">
                    ${station.available_connectors > 0 ? 'Available' : 'Full'}
                </span>
            </div>
            <div class="station-info">
                <div class="station-detail">
                    <i class="fas fa-bolt"></i>
                    <span>${station.available_connectors}/${station.total_connectors} connectors available</span>
                </div>
                <div class="station-detail">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>${station.power_output_kw} kW max power</span>
                </div>
                <div class="station-detail">
                    <i class="fas fa-calendar"></i>
                    <span>Added ${new Date(station.created_at).toLocaleDateString()}</span>
                </div>
            </div>
            <div class="station-actions">
                <button class="btn btn-secondary" onclick="editStation(${station.id})">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger" onclick="deleteStation(${station.id})">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    `).join('');
}

function setupStationFilters() {
    const searchInput = document.getElementById('station-search');
    const filterSelect = document.getElementById('station-filter');

    if (searchInput) {
        searchInput.addEventListener('input', filterStations);
    }
    if (filterSelect) {
        filterSelect.addEventListener('change', filterStations);
    }
}

function filterStations() {
    // This would filter stations based on search/filter criteria
    console.log('Filtering stations...');
}

function editStation(stationId) {
    alert(`Edit station ${stationId} - Feature coming soon!`);
}

function deleteStation(stationId) {
    if (confirm('Are you sure you want to delete this station?')) {
        alert(`Delete station ${stationId} - Feature coming soon!`);
    }
}

// ===== NAVIGATION & APP INITIALIZATION =====
function initializeApp() {
    console.log('🚀 Initializing application...');
    setupNavigation();
    loadCurrentPage();
}

function setupNavigation() {
    const navLinks = document.querySelectorAll('.nav-link');
    
    navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = this.getAttribute('href').substring(1);
            showPage(target);
        });
    });

    // Sidebar toggle
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('collapsed');
        });
    }
}

function showPage(pageId) {
    console.log(`Showing page: ${pageId}`);
    
    // Hide all pages
    const pages = document.querySelectorAll('.page');
    pages.forEach(page => page.classList.remove('active'));

    // Show target page
    const targetPage = document.getElementById(`${pageId}-page`);
    if (targetPage) {
        targetPage.classList.add('active');
    }

    // Update active nav item
    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => item.classList.remove('active'));

    const activeNav = document.querySelector(`[href="#${pageId}"]`).parentElement;
    if (activeNav) {
        activeNav.classList.add('active');
    }

    // Update page title
    const pageTitle = document.getElementById('page-title');
    if (pageTitle) {
        pageTitle.textContent = getPageTitle(pageId);
    }

    // Initialize page-specific functionality
    initializePage(pageId);
}

function getPageTitle(pageId) {
    const titles = {
        'dashboard': 'Dashboard',
        'stations': 'Charging Stations',
        'users': 'User Management',
        'sessions': 'Charging Sessions',
        'settings': 'System Settings'
    };
    return titles[pageId] || 'Dashboard';
}

function initializePage(pageId) {
    console.log(`Initializing page: ${pageId}`);
    switch (pageId) {
        case 'dashboard':
            initDashboard();
            break;
        case 'stations':
            initStations();
            break;
        case 'users':
            // initUsers(); - Add later
            break;
        case 'sessions':
            // initSessions(); - Add later
            break;
        case 'settings':
            // Settings page doesn't need special initialization
            break;
    }
}

function loadCurrentPage() {
    const hash = window.location.hash.substring(1) || 'dashboard';
    showPage(hash);
}

function showError(message) {
    console.error('Error:', message);
    alert(`Error: ${message}`);
}

// ===== START THE APPLICATION =====
document.addEventListener('DOMContentLoaded', function() {
    console.log('📄 DOM loaded, checking auth...');
    if (checkAuth()) {
        console.log('✅ User authenticated, initializing app...');
        initializeApp();
    } else {
        console.log('❌ User not authenticated');
    }
});
















// Debug info
console.log('✅ All functions loaded successfully');
console.log('✅ getDashboardData:', typeof getDashboardData);
console.log('✅ initDashboard:', typeof initDashboard);
console.log('✅ checkAuth:', typeof checkAuth);











































<!-- <!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EVCharge - Customer App</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html> -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Charging - Customer Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        /* App Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #1e293b;
            color: white;
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #334155;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo {
            font-size: 1.5rem;
            color: #10b981;
        }

        .sidebar-nav {
            list-style: none;
            padding: 1rem 0;
        }

        .nav-item {
            margin: 0.25rem 0.75rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: #cbd5e1;
            text-decoration: none;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background: #334155;
            color: white;
        }

        .nav-item.active .nav-link {
            background: #10b981;
            color: white;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        /* Topbar */
        .topbar {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #64748b;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }

        .sidebar-toggle:hover {
            background: #f1f5f9;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            font-size: 1.25rem;
            color: #64748b;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: #ef4444;
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 50%;
            min-width: 1.25rem;
            text-align: center;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .user-avatar {
            width: 2.5rem;
            height: 2.5rem;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.375rem;
        }

        .logout-btn:hover {
            background: #f1f5f9;
        }

        /* Page Content */
        .page-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
            border-left: 4px solid #10b981;
        }

        .stat-icon {
            width: 3rem;
            height: 3rem;
            background: #d1fae5;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #10b981;
            font-size: 1.5rem;
        }

        .stat-info h3 {
            font-size: 1.875rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }

        .stat-info p {
            color: #64748b;
            font-size: 0.875rem;
        }

        /* Stations Grid */
        .stations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .station-card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .station-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .station-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .station-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.25rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-badge.available {
            background: #dcfce7;
            color: #166534;
        }

        .status-badge.unavailable {
            background: #fecaca;
            color: #991b1b;
        }

        .station-info {
            padding: 1.5rem;
        }

        .station-detail {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            color: #64748b;
            font-size: 0.875rem;
        }

        .station-actions {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 0.5rem;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: #10b981;
            color: white;
        }

        .btn-primary:hover {
            background: #059669;
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
        }

        .search-box {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-box i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .filters select {
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            background: white;
            font-size: 0.875rem;
        }

        /* Login/Signup Pages */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .auth-card {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-logo {
            font-size: 2rem;
            color: #10b981;
            margin-bottom: 1rem;
        }

        .auth-header h1 {
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .auth-header p {
            color: #64748b;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .password-input {
            position: relative;
        }

        .toggle-password {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
        }

        .auth-link {
            text-align: center;
            margin-top: 1.5rem;
        }

        .auth-link a {
            color: #10b981;
            text-decoration: none;
        }

        .auth-link a:hover {
            text-decoration: underline;
        }

        /* Charging Session */
        .charging-session {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .session-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .session-stat {
            text-align: center;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 0.5rem;
        }

        .session-stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
            display: block;
        }

        .session-stat-label {
            font-size: 0.875rem;
            color: #64748b;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-header h2,
            .nav-link span {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stations-grid {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                max-width: none;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .alert-error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #991b1b;
        }

        .alert-info {
            background: #eff6ff;
            border: 1px solid #dbeafe;
            color: #1e40af;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-bolt"></i>
                </div>
                <h1>Sign in to your account</h1>
                <p>Or <a href="#" id="showSignup">create a new account</a></p>
            </div>
            
            <form id="loginForm">
                <div id="loginError" class="alert alert-error hidden"></div>
                
                <div class="form-group">
                    <input type="email" id="loginEmail" placeholder="Email address" required>
                </div>
                
                <div class="form-group">
                    <div class="password-input">
                        <input type="password" id="loginPassword" placeholder="Password" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('loginPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Sign in
                </button>
            </form>
        </div>
    </div>

    <!-- Signup Page -->
    <div id="signupPage" class="auth-container hidden">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-logo">
                    <i class="fas fa-bolt"></i>
                </div>
                <h1>Create your account</h1>
                <p>Or <a href="#" id="showLogin">sign in to existing account</a></p>
            </div>
            
            <form id="signupForm">
                <div id="signupError" class="alert alert-error hidden"></div>
                
                <div class="form-group">
                    <input type="text" id="signupFullName" placeholder="Full Name" required>
                </div>

                <div class="form-group">
                    <input type="email" id="signupEmail" placeholder="Email address" required>
                </div>

                <div class="form-group">
                    <input type="tel" id="signupPhone" placeholder="Phone Number (optional)">
                </div>
                
                <div class="form-group">
                    <div class="password-input">
                        <input type="password" id="signupPassword" placeholder="Password" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('signupPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Create account
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app-container hidden">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-bolt"></i>
                </div>
                <h2>EV Charging</h2>
            </div>
            <ul class="sidebar-nav">
                <li class="nav-item active">
                    <a href="#" class="nav-link" data-page="dashboard">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="stations">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Stations</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="charging">
                        <i class="fas fa-charging-station"></i>
                        <span>Charging</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="profile">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Topbar -->
            <div class="topbar">
                <div class="topbar-left">
                    <button class="sidebar-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h3 id="pageTitle">Dashboard</h3>
                </div>
                <div class="topbar-right">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <div class="user-menu">
                        <div class="user-avatar" id="userAvatar">JD</div>
                        <button class="logout-btn" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page active">
                    <div class="mb-8">
                        <h1 id="welcomeMessage">Welcome back, John!</h1>
                        <p class="text-gray-600">Monitor your charging sessions and find available stations.</p>
                    </div>

                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalStations">12</h3>
                                <p>Total Stations</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="availableChargers">8</h3>
                                <p>Available Chargers</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-charging-station"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="activeSessions">4</h3>
                                <p>Active Sessions</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Active Charging Session -->
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900 mb-4">Current Charging Session</h2>
                            <div id="activeSession" class="charging-session">
                                <div class="text-center py-8">
                                    <i class="fas fa-exclamation-circle text-4xl text-gray-400 mb-4"></i>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">No Active Session</h3>
                                    <p class="text-gray-600 mb-4">You don't have any active charging sessions.</p>
                                    <a href="#" class="btn btn-primary" onclick="showPage('stations')">
                                        <i class="fas fa-bolt mr-2"></i>
                                        Find a Station
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Nearby Stations -->
                        <div>
                            <h2 class="text-xl font-semibold text-gray-900 mb-4">Available Stations</h2>
                            <div id="nearbyStations" class="stations-grid">
                                <!-- Stations will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stations Page -->
                <div id="stationsPage" class="page">
                    <div class="mb-8">
                        <h1>Charging Stations</h1>
                        <p class="text-gray-600">Find and select from available charging stations</p>
                    </div>

                    <!-- Search and Filter -->
                    <div class="filters">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="stationSearch" placeholder="Search stations by name or location...">
                        </div>
                        <select id="stationFilter">
                            <option value="all">All Stations</option>
                            <option value="available">Available Only</option>
                            <option value="unavailable">Unavailable</option>
                        </select>
                    </div>

                    <!-- Stations Grid -->
                    <div id="stationsGrid" class="stations-grid">
                        <!-- Stations will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Charging Page -->
                <div id="chargingPage" class="page">
                    <div class="mb-8">
                        <h1>Charging Sessions</h1>
                        <p class="text-gray-600">Monitor and manage your charging sessions</p>
                    </div>

                    <!-- Active Session -->
                    <div class="mb-12">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Active Session</h2>
                        <div id="chargingActiveSession" class="charging-session">
                            <div class="text-center py-8">
                                <i class="fas fa-battery-quarter text-4xl text-gray-400 mb-4"></i>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">No Active Session</h3>
                                <p class="text-gray-600 mb-4">You don't have any active charging sessions.</p>
                                <a href="#" class="btn btn-primary" onclick="showPage('stations')">
                                    <i class="fas fa-bolt mr-2"></i>
                                    Find a Station
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Session History -->
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-4">Session History</h2>
                        <div id="sessionHistory" class="charging-session">
                            <div class="text-center py-8">
                                <i class="fas fa-history text-4xl text-gray-400 mb-4"></i>
                                <h3 class="text-lg font-medium text-gray-900 mb-2">No Session History</h3>
                                <p class="text-gray-600">Your past charging sessions will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Profile Page -->
                <div id="profilePage" class="page">
                    <div class="mb-8">
                        <h1>Profile Settings</h1>
                        <p class="text-gray-600">Manage your account information and preferences</p>
                    </div>

                    <div class="charging-session">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="profileName" value="John Doe">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="profileEmail" value="john.doe@example.com">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" id="profilePhone" value="+1 (555) 123-4567">
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary">Cancel</button>
                            <button class="btn btn-primary">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const sampleStations = [
            {
                id: 1,
                name: "Downtown Charging Hub",
                location: "123 Main St, City Center",
                available_connectors: 4,
                total_connectors: 6,
                power_level: "50 kW",
                distance: "0.5 miles"
            },
            {
                id: 2,
                name: "Mall EV Station",
                location: "456 Shopping Ave",
                available_connectors: 2,
                total_connectors: 4,
                power_level: "150 kW",
                distance: "1.2 miles"
            },
            {
                id: 3,
                name: "Highway Rest Stop",
                location: "Highway 101, Exit 45",
                available_connectors: 0,
                total_connectors: 8,
                power_level: "350 kW",
                distance: "3.5 miles"
            }
        ];

        // State management
        let currentUser = null;
        let activeSession = null;

        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const signupPage = document.getElementById('signupPage');
        const app = document.getElementById('app');
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const pageTitle = document.getElementById('pageTitle');

        // Initialize the app
        function initApp() {
            // Check if user is logged in (in a real app, this would check localStorage/token)
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showApp();
            } else {
                showLogin();
            }

            // Set up event listeners
            setupEventListeners();
            loadStations();
        }

        function setupEventListeners() {
            // Auth navigation
            document.getElementById('showSignup').addEventListener('click', (e) => {
                e.preventDefault();
                showSignup();
            });
            document.getElementById('showLogin').addEventListener('click', (e) => {
                e.preventDefault();
                showLogin();
            });

            // Forms
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);

            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    showPage(page);
                });
            });

            // Search and filter
            document.getElementById('stationSearch').addEventListener('input', filterStations);
            document.getElementById('stationFilter').addEventListener('change', filterStations);
        }

        // Auth functions
        function showLogin() {
            loginPage.classList.remove('hidden');
            signupPage.classList.add('hidden');
        }

        function showSignup() {
            loginPage.classList.add('hidden');
            signupPage.classList.remove('hidden');
        }

        function showApp() {
            loginPage.classList.add('hidden');
            signupPage.classList.add('hidden');
            app.classList.remove('hidden');
            updateUserInfo();
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            // Simple validation
            if (email && password) {
                // In a real app, this would make an API call
                currentUser = {
                    id: 1,
                    full_name: "John Doe",
                    email: email,
                    phone_number: "+1 (555) 123-4567"
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showApp();
            } else {
                showError('loginError', 'Please fill in all fields');
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const fullName = document.getElementById('signupFullName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (fullName && email && password) {
                // In a real app, this would make an API call
                currentUser = {
                    id: 1,
                    full_name: fullName,
                    email: email,
                    phone_number: document.getElementById('signupPhone').value || ''
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showApp();
            } else {
                showError('signupError', 'Please fill in all required fields');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLogin();
            // Clear forms
            document.getElementById('loginForm').reset();
            document.getElementById('signupForm').reset();
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('welcomeMessage').textContent = `Welcome back, ${currentUser.full_name.split(' ')[0]}!`;
                document.getElementById('userAvatar').textContent = 
                    currentUser.full_name.split(' ').map(n => n[0]).join('').toUpperCase();
                
                // Update profile form
                document.getElementById('profileName').value = currentUser.full_name;
                document.getElementById('profileEmail').value = currentUser.email;
                document.getElementById('profilePhone').value = currentUser.phone_number;
            }
        }

        // Page navigation
        function showPage(pageName) {
            // Hide all pages
            pages.forEach(page => page.classList.remove('active'));
            
            // Remove active class from all nav items
            navLinks.forEach(link => link.parentElement.classList.remove('active'));
            
            // Show selected page
            document.getElementById(`${pageName}Page`).classList.add('active');
            
            // Activate corresponding nav item
            document.querySelector(`[data-page="${pageName}"]`).parentElement.classList.add('active');
            
            // Update page title
            pageTitle.textContent = getPageTitle(pageName);
            
            // Load page-specific data
            if (pageName === 'stations') {
                loadStations();
            } else if (pageName === 'charging') {
                loadChargingData();
            }
        }

        function getPageTitle(pageName) {
            const titles = {
                dashboard: 'Dashboard',
                stations: 'Charging Stations',
                charging: 'Charging Sessions',
                profile: 'Profile Settings'
            };
            return titles[pageName] || 'Dashboard';
        }

        // Station functions
        function loadStations() {
            const stationsGrid = document.getElementById('stationsGrid');
            const nearbyStations = document.getElementById('nearbyStations');
            
            if (stationsGrid) {
                stationsGrid.innerHTML = generateStationCards(sampleStations);
            }
            if (nearbyStations) {
                // Show only available stations on dashboard
                const availableStations = sampleStations.filter(s => s.available_connectors > 0).slice(0, 3);
                nearbyStations.innerHTML = generateStationCards(availableStations);
            }
        }

        function generateStationCards(stations) {
            return stations.map(station => `
                <div class="station-card">
                    <div class="station-header">
                        <div>
                            <div class="station-name">${station.name}</div>
                            <div class="station-detail">
                                <i class="fas fa-map-marker-alt"></i>
                                ${station.location}
                            </div>
                        </div>
                        <span class="status-badge ${station.available_connectors > 0 ? 'available' : 'unavailable'}">
                            ${station.available_connectors > 0 ? 'Available' : 'Full'}
                        </span>
                    </div>
                    <div class="station-info">
                        <div class="station-detail">
                            <i class="fas fa-plug"></i>
                            ${station.available_connectors}/${station.total_connectors} connectors available
                        </div>
                        <div class="station-detail">
                            <i class="fas fa-bolt"></i>
                            ${station.power_level}
                        </div>
                        <div class="station-detail">
                            <i class="fas fa-road"></i>
                            ${station.distance}
                        </div>
                    </div>
                    <div class="station-actions">
                        <button class="btn btn-primary" ${station.available_connectors === 0 ? 'disabled' : ''}
                                onclick="startCharging(${station.id})">
                            <i class="fas fa-play"></i>
                            Start Charging
                        </button>
                        <button class="btn btn-secondary" onclick="viewStation(${station.id})">
                            <i class="fas fa-info-circle"></i>
                            Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function filterStations() {
            const searchTerm = document.getElementById('stationSearch').value.toLowerCase();
            const filterStatus = document.getElementById('stationFilter').value;
            
            const filtered = sampleStations.filter(station => {
                const matchesSearch = station.name.toLowerCase().includes(searchTerm) || 
                                    station.location.toLowerCase().includes(searchTerm);
                const matchesFilter = filterStatus === 'all' || 
                                    (filterStatus === 'available' && station.available_connectors > 0) ||
                                    (filterStatus === 'unavailable' && station.available_connectors === 0);
                return matchesSearch && matchesFilter;
            });
            
            document.getElementById('stationsGrid').innerHTML = generateStationCards(filtered);
        }

        // Charging functions
        function startCharging(stationId) {
            const station = sampleStations.find(s => s.id === stationId);
            if (station && station.available_connectors > 0) {
                activeSession = {
                    id: Date.now(),
                    station: station.name,
                    startTime: new Date(),
                    energy: 0,
                    duration: 0
                };
                alert(`Charging started at ${station.name}`);
                showPage('charging');
                loadChargingData();
            }
        }

        function loadChargingData() {
            if (activeSession) {
                // Update active session display
                const now = new Date();
                const duration = Math.floor((now - activeSession.startTime) / 60000); // minutes
                const energy = (duration * 0.5).toFixed(1); // Simulate energy consumption
                
                document.getElementById('chargingActiveSession').innerHTML = `
                    <div class="session-header">
                        <h3>Charging at ${activeSession.station}</h3>
                        <button class="btn btn-danger" onclick="stopCharging()">
                            <i class="fas fa-stop"></i>
                            Stop Charging
                        </button>
                    </div>
                    <div class="session-stats">
                        <div class="session-stat">
                            <span class="session-stat-value">${duration}</span>
                            <span class="session-stat-label">Minutes</span>
                        </div>
                        <div class="session-stat">
                            <span class="session-stat-value">${energy}</span>
                            <span class="session-stat-label">kWh</span>
                        </div>
                        <div class="session-stat">
                            <span class="session-stat-value">$ ${(energy * 0.15).toFixed(2)}</span>
                            <span class="session-stat-label">Cost</span>
                        </div>
                    </div>
                `;
            }
        }

        function stopCharging() {
            if (activeSession) {
                if (confirm('Are you sure you want to stop charging?')) {
                    activeSession = null;
                    loadChargingData();
                    showPage('dashboard');
                }
            }
        }

        // Utility functions
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.parentElement.querySelector('.toggle-password');
            const icon = button.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function showError(elementId, message) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.classList.remove('hidden');
            setTimeout(() => element.classList.add('hidden'), 5000);
        }

        function viewStation(stationId) {
            const station = sampleStations.find(s => s.id === stationId);
            if (station) {
                alert(`Station Details:\n\nName: ${station.name}\nLocation: ${station.location}\nPower: ${station.power_level}\nAvailable: ${station.available_connectors}/${station.total_connectors}`);
            }
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>